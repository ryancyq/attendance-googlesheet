<script>
  $(function() {
    utils.disableButtons();

    clearOptions();
    loadConfig();

    utils.enableButtons();
  });

  function onCreateClick() {
    utils.disableButtons();
    utils.enableLoader();

    var createOptions = getOptions();

    google.script.run
      .withSuccessHandler(
        function(msg) {
          utils.success('Success! The roster timetable has been created');
        })
      .withFailureHandler(
        function(msg) {
          utils.failure(msg);
        })
      .createNew(
        createOptions.sheetname,
        createOptions.frequency,
        createOptions.startDate,
        createOptions.endDate,
        createOptions.daysInWeek,
        createOptions.customSheetname,
        createOptions.customRange
      );
  }

  function getOptions() {
    return {
      lookup_sheet_name: $('#sidebar-lookup-sheetname').val().trim(),
      lookup_range_person_name: $('#sidebar-lookup-person-name-range').val(),
      lookup_range_timeslot: $('#sidebar-lookup-timeslot-range').val(),
      lookup_range_timestamp: $('#sidebar-lookup-timestamp-range').val(),
      lookup_date_retention_days: $('#sidebar-lookup-data-retention-days').val(),

      sheet_name: $('#sidebar-fillup-sheetname').val(),
      range_person_name: $('#sidebar-fillup-person-name-range').val(),
      range_timetable: $('#sidebar-fillup-timetable-range').val(),
      range_timestamp: $('#sidebar-fillup-timestamp-range').val()
    };
  }

  function loadConfig() {
    google.script.run
      .withSuccessHandler(
        function(config) {
          if (config) {
            $('#sidebar-lookup-sheetname').val(config.lookup_sheet_name);
            $('#sidebar-lookup-person-name-range').val(config.lookup_range_person_name);
            $('#sidebar-lookup-timeslot-range').val(config.lookup_range_timeslot);
            $('#sidebar-lookup-timestamp-range').val(config.lookup_range_timestamp);
            $('#sidebar-lookup-date-retention-days').val(config.lookup_data_retention_days);

            $('#sidebar-fillup-sheetname').val(config.sheet_name);
            $('#sidebar-fillup-person-name-range').val(config.range_person_name);
            $('#sidebar-fillup-timetable-range').val(config.range_timetable);
            $('#sidebar-fillup-timestamp-range').val(config.range_timestamp);
          } else {
            console.log('unable to load config');
          }
        })
      .withFailureHandler(
        function(msg) {
          utils.failure(msg);
        })
      .readConfigForActiveSheet();
  }

  function clearOptions() {
    $('#sidebar-lookup-sheetname').val('');
    $('#sidebar-lookup-person-name-range').val('');
    $('#sidebar-lookup-timeslot-range').val('');
    $('#sidebar-lookup-timestamp-range').val('');
    $('#sidebar-lookup-date-retention-days').val('');

    $('#sidebar-fillup-sheetname').val('');
    $('#sidebar-fillup-person-name-range').val('');
    $('#sidebar-fillup-timetable-range').val('');
    $('#sidebar-fillup-timestamp-range').val('');
  }
</script>
