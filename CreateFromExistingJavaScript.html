<script>
$(function() {
    utils.disableButtons();

    clearOptions();
    loadConfig();
    
    utils.enableButtons();
  });
  
  function onCreateClick() {
    utils.disableButtons();
    utils.enableLoader();

    var createOptions = getOptions();

    google.script.run
      .withSuccessHandler(
        function(msg) {
          utils.success('Success! The roster timetable has been created');
        })
      .withFailureHandler(
        function(msg) {
          utils.failure(msg);
        })
      .createNew(
        createOptions.sheetname, 
        createOptions.frequency, 
        createOptions.startDate, 
        createOptions.endDate, 
        createOptions.daysInWeek, 
        createOptions.customSheetname, 
        createOptions.customRange
        );
  }

  function getOptions() {
    return {
      sheetname: $('#sidebar-fillup-sheetname').val().trim(),
      frequency: $('#sidebar-fillup-frequency').val(),
      startDate: $('#sidebar-fillup-start-date').val(),
      endDate: $('#sidebar-fillup-end-date').val(),
      daysInWeek: $.map($('#sidebar-fillup-days-in-week input:checked'), function(e) {
        return $(e).val();
      }),
      customSheetname: $('#sidebar-fillup-custom-dates-sheetname').val(),
      customRange: $('#sidebar-fillup-custom-dates-range').val()
    };
  }

  function loadConfig() {

    google.script.run
      .withSuccessHandler(
        function(config) {
          if(config){
            $('#sidebar-fillup-sheetname').val($('#sidebar-fillup-sheetname-default').val());
            $('#sidebar-fillup-frequency').val('d');
            $('#sidebar-fillup-start-date').val($('#sidebar-fillup-start-date-default').val());
            $('#sidebar-fillup-end-date').val($('#sidebar-fillup-end-date-default').val());
            $('#sidebar-fillup-days-in-week input:checkbox').removeAttr('checked');
            $('#sidebar-fillup-custom-dates-sheetname').val('');
            $('#sidebar-fillup-custom-dates-range').val('');
          }
        })
      .withFailureHandler(
        function(msg) {
          utils.failure(msg);
        })
      .readConfigForActiveSheet();
  }

  function clearOptions() {
    $('#sidebar-lookup-sheetname').val('');
    $('#sidebar-lookup-person-name-range').val('');
    $('#sidebar-lookup-timeslot-range').val('');
    $('#sidebar-lookup-timestamp-range').val('');
    $('#sidebar-lookup-date-retention-days').val(90);

    $('#sidebar-filup-sheetname').val('');
    $('#sidebar-filup-person-name-range').val('');
    $('#sidebar-filup-timetable-range').val('');
    $('#sidebar-filup-timestamp-range').val('');
  }
</script>
